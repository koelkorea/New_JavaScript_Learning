// [async & await]
//  :  clear style of using promise (ì¢€ ë” ê°„ê²°í•œ ë°©ì‹ì— ì¢€ ë” ë™ê¸°ì ì¸ ê°œë…ìœ¼ë¡œ promise ê°œë…ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë§Œë“  API)

//  ex) async function xxx (){ await yyy(); return 'go';}.then(ì½œë°±í•¨ìˆ˜); 


// const { reject } = require("async");

// 1. async
//  : promise ê°ì²´ë¥¼ ë§Œë“œëŠ” produce ë‹¨ê³„ì—ì„œ ë²ˆê±°ë¡­ê²Œ resolve, reject ê°™ì€ ì½œë°±í•¨ìˆ˜ ì¨ì•¼í•˜ëŠ” ê²ƒì´ ë„ˆë¬´ ë²ˆê±°ë¡œì›€
//    -> ë‹¤ ã…ˆê¹Œë¼ê³  í•˜ê³ , í‰ë²”í•œ í•¨ìˆ˜ì²˜ëŸ¼ ì„±ê³µì‹œ returnë¬¸ì— ì „ë‹¬ê°’ ì‘ì„± í›„, fucntion ì•ì— asyncë§Œ ë¶™ì´ë©´ producer ë‹¨ê³„ë¡œ ê°€ë„ë¡ ë§Œì‚¬ í•´ê²°ë˜ê²Œ ë§Œë“¦
//    -> ì‹¤í–‰ì€ ë§ˆì°¬ê°€ì§€ë¡œ ì¼ë°˜ í”„ë¡œë¯¸ìŠ¤ êµ¬ë¬¸ì²˜ëŸ¼ comsumerë‹¨ê³„ .then()ì„ ë¶™ì—¬ì„œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥

//  # async ë˜í•œ promise ê°ì²´ì´ê¸°ì—, ê·¸ ì•ˆì— promise ê°ì²´ë¥¼ ìƒì„±í•´ë„ ê·¸ í”„ë¡œë¯¸ìŠ¤ì˜ resolveì— ëŒ€í•œ ê°’ì€ ìë™ìœ¼ë¡œ í˜¸í™˜ë˜ê²Œ ì„¤ê³„ë¨

//------------------------------------------------------------------------------------------------
// ex) promise -> async ë¹„êµ ì˜ˆì‹œ

// promise VER
// function fetchUser() {

//   return new Promise( (resolve, reject) => {
//     // do network reqeust in 10 secs....
//     resolve('ellie');
//   });

// }

// async VER : ì°¸ìœ¼ë¡œ ê¹”ë”í•˜ë‹¤ ë³¼ ìˆ˜ ìˆìŒ
async function fetchUser() {
  // do network reqeust in 10 secs....
  return 'ellie';
}

const user = fetchUser();
user.then(console.log);
console.log(user);

//------------------------------------------------------------------------------------------------


// 2. await âœ¨
//  : asyncë¡œ ì„ ì–¸ë˜ì–´ ìˆëŠ” í•¨ìˆ˜ ë‚´ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•œ ì˜ˆì•½ì–´, 
//    ì‚¬ìš©ì‹œ í•´ë‹¹ êµ¬ì—­ì´ ì „ë¶€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ëŠ” asyncë‚´ì—ì„œ awaitì´ ì•ì— ë¶™ì€ ì½”ë“œì˜ ë™ì‘ì´ ëë‚ ë•Œê¹Œì§€ ë™ê¸°ì½”ë“œë§ˆëƒ¥ ê¸°ë‹¤ë ¤ ì¤Œ
//    (= promise êµ¬ë¬¸ì—ì„œ .then().catch() ë¥¼ ì¼ì„ë•Œ, í•´ë‹¹ ì½œë°±í•¨ìˆ˜ì˜ ê²°ê³¼ê°€ ë‚˜ì˜¬ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ëŠ” ê²ƒê³¼ ë¹„ìŠ·)
//    -> ì‹¤í–‰ì€ ë§ˆì°¬ê°€ì§€ë¡œ ì¼ë°˜ í”„ë¡œë¯¸ìŠ¤ êµ¬ë¬¸ì²˜ëŸ¼ comsumerë‹¨ê³„ .then()ì„ ë¶™ì—¬ì„œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥

//------------------------------------------------------------------------------------------------
// ex) promise & then -> async & await ë¹„êµ ì˜ˆì‹œ

function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function getApple() {
  await delay(2000);  //  # async ë˜í•œ promise ê°ì²´ì´ê¸°ì—, ê·¸ ì•ˆì— promise ê°ì²´ë¥¼ ìƒì„±í•´ë„ ê·¸ í”„ë¡œë¯¸ìŠ¤ì˜ resolveì— ëŒ€í•œ ê°’ì€ ìë™ìœ¼ë¡œ í˜¸í™˜ë˜ê²Œ ì„¤ê³„ë¨
  return 'ğŸ';
}

async function getBanana() {
  await delay(1000);  //  # async ë˜í•œ promise ê°ì²´ì´ê¸°ì—, ê·¸ ì•ˆì— promise ê°ì²´ë¥¼ ìƒì„±í•´ë„ ê·¸ í”„ë¡œë¯¸ìŠ¤ì˜ resolveì— ëŒ€í•œ ê°’ì€ ìë™ìœ¼ë¡œ í˜¸í™˜ë˜ê²Œ ì„¤ê³„ë¨
  return 'ğŸŒ';
}

// promise VER : then() êµ¬ë¬¸ì´ ë³¸ì˜ ì•„ë‹ˆê²Œ ì½œë°± ì§€ì˜¥í˜•ìœ¼ë¡œ ì‘ë™
// function pickFruits() {

//   return getApple().then(apple => {
//     return getBanana().then(banana => `${apple} + ${banana}`);
//   });
// }

// async & await VER 
async function pickFruits() {
  const applePromise = getApple();     
  const bananaPromise = getBanana();    // awaitì„ í•¨ìˆ˜ ë¶€ë¶€ë‹ˆ ì•„ë‹ˆë¼, ê²°ê³¼ê°’ ë¶€ë¶„ìœ¼ë¡œ ë¹¼ë²„ë¦¬ë©´ ì¢‹ì€ì ? 
  const apple = await applePromise;     //  -> í•¨ìˆ˜ê³„ì‚° ë¶€ë¶„ì€ ë™ì‹œì— ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ê³ , ê²°ê³¼ê°’ë§Œ awaitë¡œ ë°›ìœ¼ë©´? ì‹œê°„ ì ˆì•½ ì™„ë£Œ
  const banana = await bananaPromise;
  return `${apple} + ${banana}`;       
}

pickFruits().then(console.log);        // ğŸ + ğŸŒ    <- [object Promise] + [object Promise] : awaitìœ¼ë¡œ ê²°ê³¼ê°’ ë°›ëŠ” ë¶€ë¶„ì´ ì—†ìœ¼ë©´, ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ë˜ê¸°ì— ë°›ì„ ê°ì²´ê°€ ì—†ê¸°ì— ì´ë ‡ê²Œ ì°í˜
//------------------------------------------------------------------------------------------------


// 3. useful Promise APIs âœ¨
//  : í”„ë¡œë¯¸ìŠ¤ êµ¬ë¬¸ ì‘ì„±ì— ìœ ë¦¬í•œ Promise í´ë˜ìŠ¤ì˜ static ë©”ì„œë“œ ì†Œê°œ

//  - Promise.all( [ async(promiseí¬í•¨) í•¨ìˆ˜1, ... , n ] )
//    : íŒŒë¼ë¯¸í„°ë¡œ ë“¤ì–´ê°„ ë°°ì—´ ì•ˆì˜ ëª¨ë“  promise ê°ì²´ë“¤ì˜ ì‹¤í–‰ì´ ë³‘ë ¬ì ìœ¼ë¡œ ë‹¤ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ê³  ëª¨ì•„ì„œ, consumerë‹¨ê³„ ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–„
//      -> ì‹¤í–‰ì€ ë§ˆì°¬ê°€ì§€ë¡œ ì¼ë°˜ í”„ë¡œë¯¸ìŠ¤ êµ¬ë¬¸ì²˜ëŸ¼ comsumerë‹¨ê³„ .then()ì„ ë¶™ì—¬ì„œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥

//  - Promise.race( [ async(promiseí¬í•¨) í•¨ìˆ˜1, ... , n ] )
//    : íŒŒë¼ë¯¸í„°ë¡œ ë“¤ì–´ê°„ ë°°ì—´ ì•ˆì˜ ëª¨ë“  promise ê°ì²´ë“¤ì¤‘ ê°€ì¥ ë¨¼ì € ë“¤ì–´ì˜¨ ë…€ì„ì— í•œí•˜ì—¬ promise ê°ì²´ë¥¼ ë¦¬í„´í•¨
//      -> ì‹¤í–‰ì€ ë§ˆì°¬ê°€ì§€ë¡œ ì¼ë°˜ í”„ë¡œë¯¸ìŠ¤ êµ¬ë¬¸ì²˜ëŸ¼ comsumerë‹¨ê³„ .then()ì„ ë¶™ì—¬ì„œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥

//------------------------------------------------------------------------------------------------
// ex) Promise.all( [ async(promiseí¬í•¨) í•¨ìˆ˜1, ... , n ] ) ì˜ˆì‹œ
function pickAllFruits() {

  return Promise.all([getApple(), getBanana()]).then(fruits =>
    fruits.join(' + ')
  );
}

pickAllFruits().then(console.log);   // ğŸ + ğŸŒ
//------------------------------------------------------------------------------------------------

//------------------------------------------------------------------------------------------------
// ex) Promise.race( [ async(promiseí¬í•¨) í•¨ìˆ˜1, ... , n ] ) ì˜ˆì‹œ
function pickOnlyOne() {

  return Promise.race([getApple(), getBanana()]);
}

pickOnlyOne().then(console.log);  // ğŸŒ   <- ğŸëŠ” 2ì´ˆê°€ ê±¸ë¦¬ê¸°ì—, 1ì´ˆê°€ ê±¸ë¦¬ëŠ” ğŸŒë§Œ ë¨¼ì € ë¦¬í„´ë˜ì–´ ì‹¤í–‰ë¨ 
//                                            (ë™ê¸°í™”ë¡œ ì¸í•´ 2ì´ˆê°€ ê±¸ë¦¬ëŠ” ğŸ + ğŸŒë³´ë‹¤ë„ ë¹ ë¥´ê²Œ ë‚˜ì˜´)
//------------------------------------------------------------------------------------------------
